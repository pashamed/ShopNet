"use strict";(self.webpackChunkFrontend=self.webpackChunkFrontend||[]).push([[486],{9486:(ue,v,a)=>{a.r(v),a.d(v,{CheckoutModule:()=>le});var l=a(6814),p=a(2999),u=a(5861),s=a(95),e=a(4769),g=a(6448),f=a(2704),k=a(2425),A=a(7533),m=a(3971);function N(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"li",4)(1,"div",5)(2,"button",6),e.NdJ("click",function(){const c=e.CHM(t).index,d=e.oxw();return e.KtG(d.onClick(c))}),e._uU(3),e.qZA()()()}if(2&o){const t=i.$implicit,r=i.index,n=e.oxw();e.xp6(2),e.ekj("active",n.selectedIndex===r),e.Q6J("disabled",!0),e.xp6(1),e.hij(" ",t.label," ")}}function E(o,i){if(1&o&&(e.TgZ(0,"div"),e.GkF(1,7),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngTemplateOutlet",t.selected.content)}}let U=(()=>{class o extends m.B8{constructor(){super(...arguments),this.linearModeSelected=!0}ngOnInit(){this.linear=this.linearModeSelected}onClick(t){this.selectedIndex=t}static#e=this.\u0275fac=function(){let t;return function(n){return(t||(t=e.n5z(o)))(n||o)}}();static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-stepper"]],inputs:{linearModeSelected:"linearModeSelected"},features:[e._Bn([{provide:m.B8,useExisting:o}]),e.qOj],decls:4,vars:2,consts:[[1,"container"],[1,"nav","nav-pills","nav-justified"],["class","nav-item bg-light text-uppercase fw-bold",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"nav-item","bg-light","text-uppercase","fw-bold"],[1,"class","d-grid"],["title","step",1,"nav-link","py-3","text-uppercase","fw-bold",3,"disabled","click"],[3,"ngTemplateOutlet"]],template:function(r,n){1&r&&(e.TgZ(0,"div",0)(1,"ul",1),e.YNc(2,N,4,4,"li",2),e.qZA(),e.YNc(3,E,2,1,"div",3),e.qZA()),2&r&&(e.xp6(2),e.Q6J("ngForOf",n.steps),e.xp6(1),e.Q6J("ngIf",n.selected))},dependencies:[l.sg,l.O5,l.tP],styles:["button.nav-link[_ngcontent-%COMP%]:disabled:not(.active){color:#333}"]})}return o})();var y=a(9947);function J(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"h4"),e._uU(3,"Shipping address"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.saveUserAddress())}),e._uU(5," Save as Default Address "),e.qZA()(),e.TgZ(6,"div",4)(7,"div",5),e._UZ(8,"app-text-input",6),e.qZA(),e.TgZ(9,"div",5),e._UZ(10,"app-text-input",7),e.qZA(),e.TgZ(11,"div",5),e._UZ(12,"app-text-input",8),e.qZA(),e.TgZ(13,"div",5),e._UZ(14,"app-text-input",9),e.qZA(),e.TgZ(15,"div",5),e._UZ(16,"app-text-input",10),e.qZA(),e.TgZ(17,"div",5),e._UZ(18,"app-text-input",11),e.qZA()()()}if(2&o){const t=e.oxw();let r;e.Q6J("formGroup",t.checkoutForm),e.xp6(4),e.Q6J("disabled",!(null!=(r=t.checkoutForm.get("addressForm"))&&r.valid&&null!=(r=t.checkoutForm.get("addressForm"))&&r.dirty)),e.xp6(4),e.Q6J("label","First Name"),e.xp6(2),e.Q6J("label","Last Name"),e.xp6(2),e.Q6J("label","Street"),e.xp6(2),e.Q6J("label","City"),e.xp6(2),e.Q6J("label","Postal code"),e.xp6(2),e.Q6J("label","Country")}}let O=(()=>{class o{constructor(t){this.accountService=t}saveUserAddress(){var t=this;return(0,u.Z)(function*(){yield t.accountService.updateUserAddress(t.checkoutForm?.get("addressForm")?.value),t.checkoutForm?.get("addressForm")?.setErrors({street:!0})})()}static#e=this.\u0275fac=function(r){return new(r||o)(e.Y36(g.B))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-checkout-address"]],inputs:{checkoutForm:"checkoutForm"},decls:1,vars:1,consts:[["class","mt-4 ",3,"formGroup",4,"ngIf"],[1,"mt-4",3,"formGroup"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-outline-success","mb-3",3,"disabled","click"],["formGroupName","addressForm",1,"row"],[1,"form-group","col-6"],["formControlName","firstName",3,"label"],["formControlName","lastName",3,"label"],["formControlName","street",3,"label"],["formControlName","city",3,"label"],["formControlName","postalCode",3,"label"],["formControlName","country",3,"label"]],template:function(r,n){1&r&&e.YNc(0,J,19,8,"div",0),2&r&&e.Q6J("ngIf",n.checkoutForm)},dependencies:[l.O5,s.JJ,s.JL,s.sg,s.u,s.x0,y.t]})}return o})();var b=a(5516),I=a(4036),q=a(7398),Q=a(9862);let C=(()=>{class o{constructor(t){this.http=t,this.baseUrl=b.N.apiUrl}createOrder(t){var r=this;return(0,u.Z)(function*(){return yield(0,I.z)(r.http.post(r.baseUrl+"orders",t))})()}getDeliveryMethods(){return this.http.get(this.baseUrl+"orders/deliveryMethods").pipe((0,q.U)(t=>t.sort((r,n)=>n.price-r.price)))}static#e=this.\u0275fac=function(r){return new(r||o)(e.LFG(Q.eN))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function M(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",4)(1,"input",5),e.NdJ("click",function(){const c=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.setShippingPrice(c))}),e.qZA(),e.TgZ(2,"label",6)(3,"strong"),e._uU(4),e.ALo(5,"currency"),e.qZA(),e._UZ(6,"br"),e.TgZ(7,"span",7),e._uU(8),e.qZA()()()}if(2&o){const t=i.$implicit;e.xp6(1),e.s9C("value",t.id),e.s9C("id",t.id),e.xp6(1),e.s9C("for",t.id),e.xp6(2),e.AsE("",t.shortName," - ",e.lcZ(5,6,t.price),""),e.xp6(4),e.Oqu(t.description)}}function P(o,i){if(1&o&&(e.TgZ(0,"div",1)(1,"div",2),e.YNc(2,M,9,8,"div",3),e.qZA()()),2&o){const t=e.oxw();e.Q6J("formGroup",t.checkoutForm),e.xp6(2),e.Q6J("ngForOf",t.deliveryMethods)}}let G=(()=>{class o{constructor(t,r){this.checkoutService=t,this.basketService=r,this.deliveryMethods=[]}ngOnInit(){this.checkoutService.getDeliveryMethods().subscribe(t=>this.deliveryMethods=t)}setShippingPrice(t){this.basketService.setShippingPrice(t)}static#e=this.\u0275fac=function(r){return new(r||o)(e.Y36(C),e.Y36(f.v))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-checkout-delivery"]],inputs:{checkoutForm:"checkoutForm"},decls:1,vars:1,consts:[["class","mt-4",3,"formGroup",4,"ngIf"],[1,"mt-4",3,"formGroup"],["formGroupName","deliveryForm",1,"row"],["class","col-6 form-group",4,"ngFor","ngForOf"],[1,"col-6","form-group"],["type","radio","formControlName","deliveryMethod",1,"form-check-input",3,"value","id","click"],[1,"form-check-label","ms-2","mb-3",3,"for"],[1,"label-description"]],template:function(r,n){1&r&&e.YNc(0,P,3,2,"div",0),2&r&&e.Q6J("ngIf",n.checkoutForm)},dependencies:[l.sg,l.O5,s.Fj,s._,s.JJ,s.JL,s.sg,s.u,s.x0,l.H9]})}return o})();var Y=a(8089);let B=(()=>{class o{static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-checkout-review"]],decls:2,vars:1,consts:[[1,"mt-4"],[3,"isBasket"]],template:function(r,n){1&r&&(e.TgZ(0,"div",0),e._UZ(1,"app-basket-summary",1),e.qZA()),2&r&&(e.xp6(1),e.Q6J("isBasket",!1))},dependencies:[Y.b]})}return o})();var Z="https://js.stripe.com/v3",j=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,_="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",h=null,x=Promise.resolve().then(function(){return i=null,null!==h||(h=new Promise(function(t,r){if(typeof window>"u"||typeof document>"u")t(null);else if(window.Stripe&&i&&console.warn(_),window.Stripe)t(window.Stripe);else try{var n=function(){for(var i=document.querySelectorAll('script[src^="'.concat(Z,'"]')),t=0;t<i.length;t++){var r=i[t];if(j.test(r.src))return r}return null}();n&&i?console.warn(_):n||(n=function(i){var t=i&&!i.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(Z).concat(t);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(r),r}(i)),n.addEventListener("load",function(){window.Stripe?t(window.Stripe):r(new Error("Stripe.js not available"))}),n.addEventListener("error",function(){r(new Error("Failed to load Stripe.js"))})}catch(c){return void r(c)}})),h;var i}),F=!1;x.catch(function(o){F||console.warn(o)});const W=["cardNumber"],z=["cardExpiry"],K=["cardCVC"];function $(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"div",8)(2,"div",9),e._UZ(3,"app-text-input",10),e.qZA()(),e.TgZ(4,"div",11)(5,"div",12)(6,"div",13),e._UZ(7,"div",14,15),e.TgZ(9,"label"),e._uU(10,"Card number"),e.qZA(),e.TgZ(11,"span",16),e._uU(12),e.qZA()()(),e.TgZ(13,"div",17)(14,"div",13),e._UZ(15,"div",14,18),e.TgZ(17,"label"),e._uU(18,"Card expiry"),e.qZA()()(),e.TgZ(19,"div",17)(20,"div",13),e._UZ(21,"div",14,19),e.TgZ(23,"label"),e._uU(24,"Card CVC"),e.qZA()()()()()),2&o){const t=e.oxw();e.Q6J("formGroup",t.checkoutForm),e.xp6(3),e.Q6J("label","Name on card"),e.xp6(9),e.Oqu(t.cardErrors)}}function ee(o,i){1&o&&e._UZ(0,"i",20)}let te=(()=>{class o{constructor(t,r,n,c){this.basketService=t,this.checkoutService=r,this.toastr=n,this.router=c,this.stripe=null,this.cardErrors=null,this.cardNumberOk=!1,this.cardExpiryOk=!1,this.cardCvcOk=!1,this.loading=!1}ngOnInit(){console.log(this.cardErrors),this.initStripe()}submitOrder(){var t=this;return(0,u.Z)(function*(){t.loading=!0;const r=yield t.basketService.getCurrentBasketValue();try{const n=yield t.createOrder(r),c=yield t.confirmPaymentWithStripe(r);c.paymentIntent?(t.basketService.deleteBasket(r),t.router.navigate(["checkout/success"],{state:n})):t.toastr.error(c.error.message)}catch(n){console.error(n),t.toastr.error(n.message)}finally{t.loading=!1}})()}confirmPaymentWithStripe(t){var r=this;return(0,u.Z)(function*(){if(!t)throw new Error("Basket is null");const n=yield r.stripe?.confirmCardPayment(t.clientSecret,{payment_method:{card:r.cardNumber,billing_details:{name:r.checkoutForm?.get("paymentForm")?.get("nameOnCard")?.value}}}).catch(c=>{throw new Error(c)});if(!n)throw new Error("Problem with payment");return n})()}createOrder(t){var r=this;return(0,u.Z)(function*(){if(!t)throw new Error("Basket is null");const n=r.getOrderToCreate(t);return yield r.checkoutService.createOrder(n)})()}getOrderToCreate(t){const r=this.checkoutForm?.get("deliveryForm")?.get("deliveryMethod")?.value,n=this.checkoutForm?.get("addressForm")?.value;if(!r||!n)throw new Error("Problem with basket");return{basketId:t.id,deliveryMethodId:r,shipToAddress:n}}initStripe(){var t=this;return(0,u.Z)(function*(){t.stripe=yield function(){for(var i=arguments.length,t=new Array(i),r=0;r<i;r++)t[r]=arguments[r];F=!0;var n=Date.now();return x.then(function(c){return function(i,t,r){if(null===i)return null;var n=i.apply(void 0,t);return function(i,t){!i||!i._registerWrapper||i._registerWrapper({name:"stripe-js",version:"2.1.10",startTime:t})}(n,r),n}(c,t,n)})}(b.N.stripePK);const r=t.stripe?.elements();r&&(t.cardNumber=r.create("cardNumber"),t.cardNumber.mount(t.cardNumberElement?.nativeElement),t.cardNumber.on("change",n=>{n.error&&(t.cardErrors=n.error.message),n.complete&&(t.cardNumberOk=!0),t.cardErrors=null}),t.cardExpiry=r.create("cardExpiry"),t.cardExpiry.mount(t.cardExpiryElement?.nativeElement),t.cardExpiry.on("change",n=>{n.error&&(t.cardErrors=n.error.message),n.complete&&(t.cardExpiryOk=!0),t.cardErrors=null}),t.cardCvc=r.create("cardCvc"),t.cardCvc.mount(t.cardCvcElement?.nativeElement),t.cardCvc.on("change",n=>{n.error&&(t.cardErrors=n.error.message),n.complete&&(t.cardCvcOk=!0),t.cardErrors=null}))})()}paymentFormOk(){return this.cardNumberOk&&this.cardCvcOk&&this.cardExpiryOk&&this.checkoutForm?.get("paymentForm")?.valid}static#e=this.\u0275fac=function(r){return new(r||o)(e.Y36(f.v),e.Y36(C),e.Y36(k._W),e.Y36(p.F0))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-checkout-payment"]],viewQuery:function(r,n){if(1&r&&(e.Gf(W,5),e.Gf(z,5),e.Gf(K,5)),2&r){let c;e.iGM(c=e.CRH())&&(n.cardNumberElement=c.first),e.iGM(c=e.CRH())&&(n.cardExpiryElement=c.first),e.iGM(c=e.CRH())&&(n.cardCvcElement=c.first)}},inputs:{checkoutForm:"checkoutForm"},decls:9,vars:3,consts:[["class","mt-4",3,"formGroup",4,"ngIf"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],[1,"btn","btn-outline-primary",3,"disabled","click"],[1,"fa","fa-angle-right"],["class","fa fa-spinner fa-spin",4,"ngIf"],[1,"mt-4",3,"formGroup"],[1,"row"],["formGroupName","paymentForm",1,"form-group","col-12"],["formControlName","nameOnCard",3,"label"],[1,"row","mb-3"],[1,"col-6"],[1,"form-floating"],[1,"form-control"],["cardNumber",""],[1,"text-danger"],[1,"col-3"],["cardExpiry",""],["cardCVC",""],[1,"fa","fa-spinner","fa-spin"]],template:function(r,n){1&r&&(e.YNc(0,$,25,3,"div",0),e.TgZ(1,"div",1)(2,"button",2),e._UZ(3,"i",3),e._uU(4,"Back to order "),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return n.submitOrder()}),e._uU(6,"Submit order"),e._UZ(7,"i",5),e.YNc(8,ee,1,0,"i",6),e.qZA()()),2&r&&(e.Q6J("ngIf",n.checkoutForm),e.xp6(5),e.Q6J("disabled",n.loading||!n.paymentFormOk),e.xp6(3),e.Q6J("ngIf",n.loading))},dependencies:[l.O5,s.JJ,s.JL,s.sg,s.u,s.x0,y.t,m.po]})}return o})();function re(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.createPaymentIntent())}),e._uU(1,"Next"),e.qZA()}}function ne(o,i){if(1&o&&(e.TgZ(0,"button",6),e._uU(1,"View your order"),e.qZA()),2&o){const t=e.oxw();e.MGl("routerLink","/orders/",t.order.id,"")}}function ie(o,i){1&o&&(e.TgZ(0,"button",7),e._uU(1,"Go to orders"),e.qZA())}const ce=[{path:"",component:(()=>{class o{constructor(t,r,n,c){this.fb=t,this.accountService=r,this.basketService=n,this.toast=c,this.checkoutForm=this.fb.group({addressForm:this.fb.group({firstName:["",s.kI.required],lastName:["",s.kI.required],street:["",s.kI.required],city:["",s.kI.required],postalCode:["",s.kI.required],country:["",s.kI.required]}),deliveryForm:this.fb.group({deliveryMethod:["",s.kI.required]}),paymentForm:this.fb.group({nameOnCard:["",s.kI.required]})})}ngOnInit(){this.getAddressFormValues(),this.getDeliveryMethodValue()}getAddressFormValues(){var t=this;return(0,u.Z)(function*(){yield t.accountService.getCurrentUserAddress(),t.accountService.user?.address&&t.checkoutForm.get("addressForm")?.patchValue(t.accountService.user?.address)})()}getDeliveryMethodValue(){var t=this;return(0,u.Z)(function*(){const r=yield t.basketService.getCurrentBasketValue();r&&r.deliveryMethodId&&t.checkoutForm.get("deliveryForm")?.get("deliveryMethod")?.patchValue(r.deliveryMethodId.toString())})()}checkFormValid(){return!(!this.checkoutForm.get("addressForm")?.valid||!this.checkoutForm.get("deliveryForm")?.valid)}createPaymentIntent(){var t=this;return(0,u.Z)(function*(){yield t.basketService.createPaymentIntent().catch(r=>t.toast.error(r.message))})()}static#e=this.\u0275fac=function(r){return new(r||o)(e.Y36(s.qu),e.Y36(g.B),e.Y36(f.v),e.Y36(k._W))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-checkout"]],decls:29,vars:13,consts:[[1,"container","mt-5"],[1,"row"],[1,"col-8"],["appStepper",""],[3,"label","completed"],[3,"checkoutForm"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["routerLink","/basket",1,"btn","btn-outline-primary"],["cdkStepperNext","",1,"btn","btn-outline-primary",3,"disabled"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[3,"label"],["class","btn btn-outline-primary ","cdkStepperNext","",3,"click",4,"ngIf"],[1,"col-4"],["cdkStepperNext","",1,"btn","btn-outline-primary",3,"click"]],template:function(r,n){if(1&r&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-stepper",null,3)(5,"cdk-step",4),e._UZ(6,"app-checkout-address",5),e.TgZ(7,"div",6)(8,"button",7),e._uU(9,"Back to basket"),e.qZA(),e.TgZ(10,"button",8),e._uU(11,"Next"),e.qZA()()(),e.TgZ(12,"cdk-step",4),e._UZ(13,"app-checkout-delivery",5),e.TgZ(14,"div",6)(15,"button",9),e._uU(16,"Previous"),e.qZA(),e.TgZ(17,"button",8),e._uU(18,"Next"),e.qZA()()(),e.TgZ(19,"cdk-step",10),e._UZ(20,"app-checkout-review"),e.TgZ(21,"div",6)(22,"button",9),e._uU(23,"Previous"),e.qZA(),e.YNc(24,re,2,0,"button",11),e.qZA()(),e.TgZ(25,"cdk-step",4),e._UZ(26,"app-checkout-payment",5),e.qZA()()(),e.TgZ(27,"div",12),e._UZ(28,"app-order-totals"),e.qZA()()()),2&r){let c,d,S,T,w;e.xp6(5),e.Q6J("label","Address")("completed",null==(c=n.checkoutForm.get("addressForm"))?null:c.valid),e.xp6(1),e.Q6J("checkoutForm",n.checkoutForm),e.xp6(4),e.Q6J("disabled",null==(d=n.checkoutForm.get("addressForm"))?null:d.invalid),e.xp6(2),e.Q6J("label","Delivery")("completed",null==(S=n.checkoutForm.get("deliveryForm"))?null:S.valid),e.xp6(1),e.Q6J("checkoutForm",n.checkoutForm),e.xp6(4),e.Q6J("disabled",null==(T=n.checkoutForm.get("deliveryForm"))?null:T.invalid),e.xp6(2),e.Q6J("label","Review"),e.xp6(5),e.Q6J("ngIf",n.checkFormValid()),e.xp6(1),e.Q6J("label","Payment")("completed",null==(w=n.checkoutForm.get("paymentForm"))?null:w.valid),e.xp6(1),e.Q6J("checkoutForm",n.checkoutForm)}},dependencies:[l.O5,p.rH,A.S,U,m.be,m.st,m.po,O,G,B,te]})}return o})()},{path:"success",component:(()=>{class o{constructor(t){this.router=t;const r=this.router.getCurrentNavigation();this.order=r?.extras?.state}static#e=this.\u0275fac=function(r){return new(r||o)(e.Y36(p.F0))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-checkout-success"]],decls:10,vars:2,consts:[[1,"container","mt-5"],[1,"fa","fa-check-circle","fa-5x",2,"color","green"],[1,"mb-4"],["src","https://em-content.zobj.net/source/microsoft/319/winking-face_1f609.png","title","smileyFace",2,"max-height","3em"],["class","btn btn-outline-success",3,"routerLink",4,"ngIf"],["class","btn btn-outline-success","routerLink","/orders",4,"ngIf"],[1,"btn","btn-outline-success",3,"routerLink"],["routerLink","/orders",1,"btn","btn-outline-success"]],template:function(r,n){1&r&&(e.TgZ(0,"div",0)(1,"div"),e._UZ(2,"i",1),e.qZA(),e.TgZ(3,"h2"),e._uU(4,"Thank you. Your order is confirmed"),e.qZA(),e.TgZ(5,"p",2),e._uU(6," Your order will be shipped soon, probably"),e._UZ(7,"img",3),e.qZA(),e.YNc(8,ne,2,1,"button",4),e.YNc(9,ie,2,0,"button",5),e.qZA()),2&r&&(e.xp6(8),e.Q6J("ngIf",n.order),e.xp6(1),e.Q6J("ngIf",!n.order))},dependencies:[l.O5,p.rH]})}return o})()}];let se=(()=>{class o{static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275mod=e.oAB({type:o});static#r=this.\u0275inj=e.cJS({imports:[p.Bz.forChild(ce),p.Bz]})}return o})();var ae=a(6208);let le=(()=>{class o{static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275mod=e.oAB({type:o});static#r=this.\u0275inj=e.cJS({imports:[l.ez,se,ae.m]})}return o})()}}]);